---
title: "Buying a Car With The Electric Vehicle Transition "
author: "Andrew Pfeifer"
date: "`r Sys.Date()`"
output: pdf_document
bibliography: 'citations.bib'
csl: 'modern-language-association.csl'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(readxl)
library(janitor)
library("bibtex")
usedCars <- read.csv("/Users/andrewpfeifer/Documents/DCS520/project/car_prices.csv",
                       header = TRUE, stringsAsFactors=FALSE)
costLiving <- read.csv("/Users/andrewpfeifer/Documents/DCS520/project/cost_of_living_us.csv",
                       header = TRUE, stringsAsFactors=FALSE)
livingWage <- read.csv("/Users/andrewpfeifer/Documents/DCS520/project/livingwage.csv",
                       header = TRUE, stringsAsFactors=FALSE)
povertyWages <- read.csv("/Users/andrewpfeifer/Documents/DCS520/project/poverty_level_wages.csv",
                       header = TRUE, stringsAsFactors=FALSE)
currentMinWage <- read_excel("/Users/andrewpfeifer/Documents/DCS520/project/Min_wage.xlsx")
```

## Research Introduction

    With the current changes in technology, we are seeing a large push for electric vehicles. With this and the current economic atmosphere, we are seeing an effect on car prices. With all this going on, the question comes of what quality car can someone afford. This is an interesting topic for those ready to make their next car purchase. We do not know when there will be a full transition to electric vehicles or if this will even happen. With this it may be best to consider a car that does not affect the wallet as much while we wait and see. Data Science can play a role in this problem primarily to focus EV dealerships and sales of cars in areas that can afford it as opposed to locations that are still scraping by. To explore this we want to ask, does the mileage a car still have affect its value? Does the mileage of an electric car affect its value? Is there any rule of thumb for the amount of car one can afford based on their income? What is the most affordable electric and gas car for consumers? Is there a point at which a car may have too many miles on it? 
  
    Some of the packages needed are bibtex, janitor, readxl ggplot2, corplot, and dplyr. The main plots for this project would be scatter plots with regression and histograms to examine normality. The data sets that are under consideration are the minimum wage data set, used car data set, and the cost-of-living data set. To solve this problem the first step would be to clean the imported data sets. 

## Addressing The Problem

    For this research, correlation plots of the car mileage and their values should be used to determine if vehicle mileage affects the car's values. Next, plotting should be done for the car values with income (based on any rules of thumb for car purchases) to show the best options for someone in specific income brackets. After this we can condense average minimum wages in specific regions to try and identify what cars may sell well there. This research will only be able to partially answer these questions. It is up to the purchaser to decide the cars they want to purchase. For example, someone mechanically inclined would purchase a vehicle with high mileage if they are certain they can make any repairs.

## Cleaning the data

### Used Car Prices Data Set (@noauthor_us_nodate)

    First, let us look at the used car data set. There are only 5 makes included in this set and it spans only over 2 years. For this I feel confident that we can disregard the year the vehicle was sold. In the code below a search was completed to locate duplicate values. Using the distinct function these duplicates were removed and then a "NA" search was completed but none were found. This data set has mixed models with brands, for this I will assume the brand name is incorrect and remove it from the data set and we will only keep the model, mileage, and price. 

```{r, results='hide'}
get_dupes(usedCars) 
cars <- usedCars %>% distinct(.keep_all = FALSE)
sum(apply(is.na(cars), 1, any))
```

```{r}
carsReduced <- cars %>% select(model, mileage, price)

carsReduced <- mutate_if(carsReduced, is.character, as.factor)

head(carsReduced)
```

### Cost of Living Data Set (@noauthor_us_nodate-1)

    For the cost living data set, first check for NA values and duplicates. From the code below, none of these appear to be present in the data. For this set we will remove all columns but the state and total cost of living. I will make a new data set to keep the original intact while creating a new variable for the average cost of living by state. 
 
```{r}
sum(apply(is.na(costLiving), 1, any))
costLiving <- na.omit(costLiving)
get_dupes(costLiving)

costLiving <- costLiving %>% select(state, total_cost)

cost <- costLiving %>% group_by(state) %>% summarise(average_cost = mean(total_cost))
head(cost)
```

    Since the focus of the research is based on more current events and the used car data set only includes two years of sales the minimum wage data will be only of the current minimum wages by state. This should not need any adjustments besides converting the hourly rate into a yearly rate. 

### Minimum Wage Data Set (@noauthor_us_nodate-2)

```{r}
colnames(currentMinWage) <- c('State', 'Min_wage_2023', 'Min_wage_2022')

yearlyMinWage <- currentMinWage %>%  mutate(across(Min_wage_2023, function(x) x*40*52))
yearlyMinWage <- yearlyMinWage %>%  mutate(across(Min_wage_2022, function(x) x*40*52))
head(yearlyMinWage)
```

## Analysis

    The First strep in the Analysis is to look for the correlations for a vehicles mileage and its price. First 

```{r}
ggplot(carsReduced, aes(x = mileage, fill = model)) + geom_histogram() + 
  facet_wrap(carsReduced$model) + 
  labs(title = 'Used Car Mileage', x = 'Mileage', y = 'Frequency')

ggplot(carsReduced, aes(x = price, fill = model)) + geom_histogram() + 
  facet_wrap(carsReduced$model) + 
  labs(title = 'Used Car Prices', x = 'price', y = 'Frequency')

ggplot(carsReduced, aes(x = mileage, y = price, color = model)) + geom_point() + facet_wrap(carsReduced$model) + stat_smooth(formula = y ~ x, method="lm",se=FALSE) + 
  labs(title = 'Mileage vs. Price', x = 'Mileage', y = 'Price') + labs(title = 'Used Car Prices Based on Mileage', x = 'Mileage', y = 'Price')
```

    Based on the plots above there doesn't seem to be any statistical significance in the data. To verify this we will run correlation tests on each make/model to confirm.

```{r}
Honda <- filter(carsReduced, model == 'Accord')
Chevrolet <- filter(carsReduced, model == 'Cruze')
Ford <- filter(carsReduced, model == 'Fusion')
Nissan <- filter(carsReduced, model == 'Altima')
Toyota <- filter(carsReduced, model == 'Camry')
cor.test(Honda$mileage, Honda$price, method = "spearman")
cor.test(Chevrolet$mileage, Chevrolet$price, method = "spearman")
cor.test(Nissan$mileage, Nissan$price, method = "spearman")
cor.test(Toyota$mileage, Toyota$price, method = "spearman")
cor.test(Ford$mileage, Ford$price, method = "spearman")
```
    According to Spearman's rank correlation there is no statistical significance in the data for mileage vs price. This is unfortunate as the remainder of the analysis was dependent upon this information. If there was a significance we could then then find standard rules of thumbs to car purchases and group the minimum wage data base and model a K cluster algorithm to find segments bast suited for income level. Furthermore, this could have been similarly done to the cost of living data base to determine which states these vehicles would sell well in. Surprisingly the p values for all makes are positive as well which implies with higher mileage comes a higher cost which is the opposite of what was expected. That being said since the p values are so large this isn't necessarily the case.

## Implications

    Once a model is able to be completed for this data, there should be less advertisements for cars that are unaffordable to specific regions of the US. This would help reduce cost of advertisement for dealerships, but at the same time provide specific populations with a choice of vehicles that are actually affordable. Ideally, if the same correlations corresponded to an electric vehicle database then the same steps can be taken to best provide consumers with electric vehicles in their price range.

## Limitations

    Some of the limitations for this research would be only having 4 brands of vehicles on the car data set. Also, no data base for electric vehicles has been located. When attempting to web scrape for this information I wasn't able to locate a website that wouldn't crash when implementing web scrapping. 
Other limitations would include a large enough time span of data. This could have shown a relationship between car mileage and value. There may have been some researcher bias when building the data base. After further review was completed there are some cars with used prices that are higher than the new car's MSRP. This can be improved upon with bigger data sets and possibly have the data being broken down per zip code to verify if this has an impact on a vehicle's price.

## Concluding Remarks

    As shown, there is little statistical significance between a vehicle's mileage and price based on this data set. This would imply that there are other outstanding variables that contribute to vehicle prices that we are unable to account for with the data provided. This would mean that with the data we currently have we would be unable to predict the cars a person can purchase based on mileage alone. However, with more research into other variables, this information may be obtained. These would include a breakdown of vehicles sold per zip code, as the dollar may be weighed more in some areas than others. Also, popularity of a vehicle would contribute to the purchase price as well, so a data set of ranked vehicles by popularity would be needed. Further research would be needed into such variables as well as obtaining a data set for electric vehicle prices. Once the research is completed, people could have an easier time locating the vehicles they can purchase based on their income bracket. Dealerships will also be able to establish themselves in or advertise in communities that can afford their vehicles. This could lead to a cost savings that could be passed onto the consumer.

## References